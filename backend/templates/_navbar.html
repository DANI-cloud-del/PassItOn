<header>
    <div class="logo">
        <span>PassItOn</span>
    </div>
    
    <div class="search-container" style="position: relative; max-width: 500px; flex: 1;">
        <input type="text" class="search-bar" placeholder="Search for items...">
        <button class="filter-btn" title="Filter Search" aria-label="Filter Search">
            <i class="fas fa-filter"></i>
        </button>
    </div>

    <div class="nav-icons">
        <button class="icon-btn" id="themeToggle" title="Toggle Theme">
            <i class="fas fa-moon"></i>
        </button>
        
        <div class="dropdown" style="position: relative;">
            <button id="makeRequestBtn" class="icon-btn" title="Make a Request" style="background:none; border:none; color:inherit; font-size:1.3rem; cursor:pointer; padding:6px; border-radius:50%;">
                <i class="fas fa-plus-circle"></i>
                <span class="notification-badge" style="display:none;">!</span>
            </button>
            <div id="makeRequestContent" class="dropdown-content">
                <form id="requestForm" style="display:flex; flex-direction:column; gap:10px;">
                    <textarea id="requestInput" placeholder="Enter your request here..." rows="5" style="resize:vertical; padding:12px; border-radius:8px; border:1.5px solid var(--primary);"></textarea>
                    <button type="submit" class="btn-primary">Send Request</button>
                </form>
            </div>
        </div>

        <button class="icon-btn" id="addToCartBtn" title="Cart">
            <i class="fas fa-shopping-cart"></i>
            <span class="notification-badge" id="cartCount" style="display: none;">0</span>
        </button>

        {% if session.get('username') %}
  <button id="logoutBtn" class="icon-btn" title="Logout">
    Logout ({{ session.get('username') }})
  </button>
{% else %}
  <a href="{{ url_for('login') }}" id="loginBtn" class="icon-btn" title="Login">Login</a>
{% endif %}

        <div class="dropdown icon-btn" id="notificationDropdown">
            <button id="notificationBtn" title="Notifications" style="background:none; border:none; color:inherit; font-size: 1.3rem; cursor:pointer; position: relative;">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" id="notificationCount">3</span>
            </button>
            <div class="dropdown-content" id="notificationContent" style="display:none; position: absolute; right: 0; top: 110%; background: var(--card-bg); border-radius: 8px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); max-width: 300px; max-height: 350px; overflow-y: auto; z-index: 25; padding: 12px; font-size: 0.9rem;">
                <ul id="notificationList" style="list-style:none; padding:0; margin:0;">
                    <!-- notifications will be dynamically loaded here -->
                </ul>
            </div>
        </div>
    </div>
</header>

<script>
    
    document.getElementById('addToCartBtn').addEventListener('click', () => {
        alert('Show cart summary or navigate to cart page.');
    });
</script>

<script>
    const announcementBtn = document.getElementById('announcementBtn');
    const announcementContent = document.getElementById('announcementContent');
    const announcementList = document.getElementById('announcementList');

    // Example announcements you may pass from backend or define here
    const announcements = [
        "Need a calculator for physics lab.",
        "Looking for a used ballpoint pen.",
        "Extension cords available for sharing.",
        "Offering used textbooks in good condition."
    ];

    // Populate announcement list
    announcements.forEach(text => {
        const li = document.createElement('li');
        li.textContent = text;
        announcementList.appendChild(li);
    });

    // Toggle dropdown show/hide
    announcementBtn.addEventListener('click', () => {
        if (announcementContent.style.display === 'none' || announcementContent.style.display === '') {
            announcementContent.style.display = 'block';
        } else {
            announcementContent.style.display = 'none';
        }
    });

    // Close dropdown if clicked outside
    window.addEventListener('click', function(event) {
        if (!announcementBtn.contains(event.target) && !announcementContent.contains(event.target)) {
            announcementContent.style.display = 'none';
        }
    });
</script>

<script>
    const notificationBtn = document.getElementById('notificationBtn');
    const notificationContent = document.getElementById('notificationContent');
    const notificationList = document.getElementById('notificationList');

    // Sample notification messages
    const notifications = [
        "Alice requested a calculator.",
        "New item added to Stationery Pack.",
        "Event: E-waste drive next Monday!"
    ];

    // Populate notifications list
    notifications.forEach(text => {
        const li = document.createElement('li');
        li.textContent = text;
        notificationList.appendChild(li);
    });

    // Toggle dropdown visibility on bell click
    notificationBtn.addEventListener('click', () => {
        if (notificationContent.style.display === 'block') {
            notificationContent.style.display = 'none';
        } else {
            notificationContent.style.display = 'block';
        }
    });

    // Hide dropdown if click outside
    window.addEventListener('click', (e) => {
        if (!notificationBtn.contains(e.target) && !notificationContent.contains(e.target)) {
            notificationContent.style.display = 'none';
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const makeRequestBtn = document.getElementById('makeRequestBtn');
        const makeRequestContent = document.getElementById('makeRequestContent');
        const requestForm = document.getElementById('requestForm');
        const requestInput = document.getElementById('requestInput');

        if (!makeRequestBtn || !makeRequestContent || !requestForm || !requestInput) {
            console.error('One or more request elements not found');
            return;
        }

        // Toggle dropdown with class instead of display property
        makeRequestBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            makeRequestContent.classList.toggle('show');
            if(makeRequestContent.classList.contains('show')) {
                requestInput.focus();
            }
        });

        // Close dropdown by removing class
        document.addEventListener('click', (e) => {
            if (!makeRequestBtn.contains(e.target) && !makeRequestContent.contains(e.target)) {
                makeRequestContent.classList.remove('show');
            }
        });

        requestForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const requestText = requestInput.value.trim();
            if(!requestText) {
                alert('Please enter a request');
                return;
            }
            alert(`Request sent: ${requestText}`);
            makeRequestContent.classList.remove('show');
            requestInput.value = '';
        });
    });
</script>

<script>
    
    document.addEventListener("DOMContentLoaded", function () {
  const logoutBtn = document.getElementById("logoutBtn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", function () {
      window.location.href = "/logout";
    });
  }
});

</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
            // Theme Toggle
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = themeToggle.querySelector('i');
            
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                } else {
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                }
            })});
  </script>
